pipeline {
	agent {label 'macos'}
	stages {
        stage('Build') {
            steps {
                sh 'xcodebuild -project SampleUnitTesting.xcodeproj -scheme SampleUnitTesting -destination "platform=iOS Simulator,name=iPhone 11,OS=14.4"'
            }
        }
        stage('Tests') {
            steps {
                sh 'xcodebuild test -project SampleUnitTesting.xcodeproj -scheme SampleUnitTestingXCTests -destination "platform=iOS Simulator,name=iPhone 11 Pro,OS=14.4"'
            }
        }
        stage('Security') {
            steps {
                sh 'curl -fsSL https://raw.githubusercontent.com/ZupIT/horusec/main/deployments/scripts/install.sh | bash -s latest'
                sh 'horusec start -p="./" -e="true"'
            }
        }
    }
}